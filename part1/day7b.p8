pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8
#include serial.p8

function mean(tbl)
 local total=0
 for val in all(tbl) do
  total += shr(val,15)
 end
 return flr(shl(total/#tbl,15) + 0.5)
end

function crab_distance(tbl,middle)
 local total=0
 for i=1,#tbl do
  local x=tbl[i]
  local diff=abs(x-middle)
  local cost=minify(diff)*(diff+1)/2
  total += cost
  
  -- get nervous if the number
  -- is about to overflow
  assert(total < 28000)
 end
 return total
end

-- the position that minimizes
-- this cost is almost the mean.
-- so search a window around
-- the mean for the actual best
-- cost.

function best_cost(tbl)
 local m=mean(tbl)
 local best=32767
 for i=m-5,m+5 do
  local cost=crab_distance(tbl, i)
  print(i..": "..inttext(cost))
  if cost < best then
   best = cost
  end
 end
 return inttext(best)
end

crabs = {16,1,2,0,4,2,7,1,2,14}
test(
 mean(crabs),
 5,
 "mean of example"
)

test(
 best_cost(crabs),
 "168",
 "example answer"
)

--split input on commas
input = split(
 read_lines()[1],
 ","
)
check(best_cost(input))
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77700000000077700070777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077007770707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000007007070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000007007770777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000007000070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000077700070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077707770777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700700000000700070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077707770077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700700000070007000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077707770777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077707000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700700000000707000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000077707770777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000070007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000077707770777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77007770000000007770770077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07007070070000000070070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07007070000000000770070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07007070070000000070070007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707770000000007770777077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077707070777077707770700077700000777077000770707077707770000000007700700077700000000000000000000000000000000000000000
0bbbbb00000070007070707077707070700070000000707070707000707070007070070000000700700070700000000000000000000000000000000000000000
0bbbbb00000077000700777070707770700077000000777070707770707077007700000000000700777077700000000000000000000000000000000000000000
00bbb000000070007070707070707000700070000000707070700070777070007070070000000700707070700000000000000000000000000000000000000000
000b0000000077707070707070707000777077700000707070707700777077707070000000007770777077700000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707770777077007070000077700770777000007770770077707070777000000000000000000000000000000000000000000000000000000000000000000000
70707000707070707070000070007070707000000700707070707070070000000000000000000000000000000000000000000000000000000000000000000000
77007700777070707770000077007070770000000700707077707070070000000000000000000000000000000000000000000000000000000000000000000000
70707000707070700070000070007070707000000700707070007070070000000000000000000000000000000000000000000000000000000000000000000000
70707770707077707770000070007700707000007770707070000770070000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000700077707700777007700000777077707770770000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000700007007070700070000000707070007070707000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000700007007070770077700000770077007770707000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000700007007070700000700000707070007070707000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000777077707070777077000000707077707070777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770077707770707070707000000000000000000000000000000000000000000000000000000000000000000000000000
70707070707007000000070070707070070070007070707070707000000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00707070007007000000070070707070070000707070007000707070000000000000000000000000000000000000000000000000000000000000000000000000
00707770007000000000777077707770777077707770007000707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770077707070777077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070707007000000070070707070070070007070700000700070000000000000000000000000000000000000000000000000000000000000000000000000
77707770707000000000070070707070070077707770777077700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070707007000000070070707070070000700070007070000070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777077700070777077700070000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770770000000000770077707770770077707700700077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070070007000000070070707070070070000700700070707070000000000000000000000000000000000000000000000000000000000000000000000000
77707770070000000000070070707070070077700700777070707770000000000000000000000000000000000000000000000000000000000000000000000000
00700070070007000000070070707070070000700700707070700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777077707770777077700070000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770070707770700077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070007007000000070070707070070070707070700070700070000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777077700770000000000000000000000000000000000000000000000000000000000000000000000000
00700070700007000000070070707070070000700070707000700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777000700070777000707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770070707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070007007000000070070707070070070707070007000700070000000000000000000000000000000000000000000000000000000000000000000000000
77707770077000000000070070707070070077707770007000700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070007007000000070070707070070000707070007000700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777000707770007000700070000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770707000000000770077707770770070707770777070007700000000000000000000000000000000000000000000000000000000000000000000000000
70707070707007000000070070707070070070707070707070000700000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777077700700000000000000000000000000000000000000000000000000000000000000000000000000
00700070007007000000070070707070070000707070707070700700000000000000000000000000000000000000000000000000000000000000000000000000
00700070007000000000777077707770777000707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770070707770777070707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070700007000000070070707070070070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00700070007007000000070070707070070000700070007000700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777000700070007000707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770700000000000770077707770770077707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070700007000000070070707070070070000070707000707070000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770707007707070000000000000000000000000000000000000000000000000000000000000000000000000
00700070707007000000070070707070070000707000707000707070000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777077707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770077707770770077007770000000000000000000000000000000000000000000000000000000000000000000000000
70707070007007000000070070707070070070007000070007007000000000000000000000000000000000000000000000000000000000000000000000000000
77707770007000000000070070707070070077707770070007007770000000000000000000000000000000000000000000000000000000000000000000000000
00700070007007000000070070707070070000700070070007000070000000000000000000000000000000000000000000000000000000000000000000000000
00700070007000000000777077707770777077707770777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770077707770777077707700000000000000000000000000000000000000000000000000000000000000000000000000
70707070707007000000070070707070070070007070007070700700000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777070700700000000000000000000000000000000000000000000000000000000000000000000000000
00700070707007000000070070707070070000700070700070700700000000000000000000000000000000000000000000000000000000000000000000000000
00700070777000000000777077707770777077700070777077707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707770777000000000770077707770770070007070777077707770000000000000000000000000000000000000000000000000000000000000000000000000
70707070707007000000070070707070070070007070007070700070000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000000000070070707070070077707770777077700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070007007000000070070707070070070700070700070700070000000000000000000000000000000000000000000000000000000000000000000000000
00700070007000000000777077707770777077700070777077700070000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000bbb0bb000bb0b0b0bbb0bbb000000000bb00bbb0bbb0bb00b0b0bbb0bbb0bbb0bbb0000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b0b000b0b0b000b0b00b0000000b00b0b0b0b00b00b0b0b0b000b000b000b0000000000000000000000000000000000000
b000bbb0bb00b000bb000000bbb0b0b0bbb0b0b0bb00bb00000000000b00b0b0b0b00b00bbb0bbb000b000b000b0000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b000b0bbb0b000b0b00b0000000b00b0b0b0b00b0000b0b0b000b000b000b0000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000b0b0b0b0bb00bbb0bbb0b0b000000000bbb0bbb0bbb0bbb000b0bbb000b000b000b0000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

