pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8
#include serial.p8

-- a kinda continuous looking
-- color scale
scale = {[0]=0,1,13,4,8,14,9,10,6,7}

-- work with a big global array
-- at memory address 0 to 0x2000
function put(x,y,val)
 poke(y*128 + x, val)
end

function get(x,y)
 return peek(y*128 + x)
end

-- draw the input on the screen
-- and also store it in the
-- big global array
function plot(lines)
 cls(0)
 for row=1,#lines do
  local y=row-1
  local heights=split(lines[row], "")
  for col=1,#heights do
   local x=col-1
   local h=heights[col]
   pset(x,y,scale[h])
   put(x,y,h)
  end
 end
 cursor(0,112)
end

function find_valleys(lines,width,height)
 plot(lines)

 local risk=0
 for x=0,width-1 do
  for y=0,height-1 do
   local valley=true
   local v=get(x,y)
   if x > 0 then
    if (v >= get(x-1,y)) valley=false
   end
   if y > 0 then
    if (v >= get(x,y-1)) valley=false
   end
   if x < width-1 then
    if (v >= get(x+1,y)) valley=false
   end
   if y < height-1 then
    if (v >= get(x,y+1)) valley=false
   end
   if valley then
    -- plot valleys in green
    pset(x,y,11)
    risk += minify(v + 1)
   end
  end
 end
 return inttext(risk)
end

function find_risk(lines)
 local width=#lines[1]
 local height=#lines
 return find_valleys(lines,width,height)
end

example = [[2199943210
3987894921
9856789892
8767896789
9899965678]]

exlines = split(example,"\n",false)
test(
 find_risk(exlines),
 "15",
 "small example"
)

check(find_risk(read_lines()))
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700044400eee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000888009990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000000aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000007770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
a9e9a9a67d487776a9e8dbd48e9a676767d1d477776a9e8b9a774d4e976a9a676a9e4b48e9a674896784769e8b8e76a9848e0000000000000000000000000000
ae848e97d187677766a94848e76776a7a67b17667776a9e8e9a671d47678e967776a66ae9a674d46767b76a9e8e76a9ed1d40000000000000000000000000000
e84b48967b76a766776a8e9aa676a9989a6777aa67776a9e9a671b176a748ea677767779a774d1d49a67e76a6e9a7ae84b1d0000000000000000000000000000
9e8489a677679a9a677669a6676a9e8d8977a9e9a674767aa774d176a9ed489a6777776a679e9b18e7778476a9a7479ed1840000000000000000000000000000
a9ee9a6776a9e9e9677777677776a9dbd7676e8e97bd77677678876a9e81d8e9a679677677a9e8d476767d176a67d76e84e80000000000000000000000000000
6a99767b477e848e7776ae7a77776a8476a9e848e7d76a976a6776a9e84b1499a67ea9e7a677a8476a6a67bd7677b4779e9e0000000000000000000000000000
77aa67677779ed476a98e8e9a676a9e87a9984d9a677ae84d9a6776a94d1d48e9678e84a9a667e77a9e9a67777a67e76a9a90000000000000000000000000000
976676a76a671bd47784d489a777769a76ee4d1e9a67ae4dbe677776a848e9aaa78484d48e9a7769984e99a67b9a77776a6a0000000000000000000000000000
e8777a98e9a671d8767d1d4e9a6797a76784d1b8e9a76784d49a67779e8eaa67674d1b1489a76a9ee4d48ea777a7667676760000000000000000000000000000
8476a9e48e9a67476ae1b1d6767be767a6784d148a7776e848e6777769e9a67b7774e4de9a6779e84dbd4e9a7676a9ea67470000000000000000000000000000
edb7644d48e77e897e8d1d9a67a96776ba67747876776a9e8e9a676a7aaa67d1d7677848e7776a9e84d48e976a7777b674d40000000000000000000000000000
97769d1b89a667e76784d8e9776a7db7767667676784766796a677a976767e8476a7678e9a677679a7a9e976a9676677e8bd0000000000000000000000000000
76a9e84d48e9a676a7e86a9a6776741d476aa6a9a671d776a767767e476769e87a9ea677a677776a767a976a9eaeaa6784d80000000000000000000000000000
876a9e84ae9a676a9a7e76a67a67e898776e976e9a7b767767776a94d4a67a97678499a677a677776a67a779e8e8e9a678e90000000000000000000000000000
4876a9e8e9a776a9e779a76789a797a76a984d48e6776a9e7a76a9e1b1ee9776a84b8e9a679a6776a9a7767e84d48e9a7e9a0000000000000000000000000000
d49767ae6a7b177e8a677871487676777764d1d8e776a9e8e9a7e84d1d48676a9e8ee7a77aea6776ae8a6a774dbd48e676a60000000000000000000000000000
b8e97769a67176a649a674db176a6a6777ae1b4e9a679e848e76a984d88e9a76a9e9a679a98e976a9849e9a678848e9a67670000000000000000000000000000
d99a677a677767e4be9a67d17679e9a67769d1a97677a84b49a76a9e4e67a6776a6a679e98487669e4d48e677ae899a67a7e0000000000000000000000000000
4e767b767776a9e8486778476a9eb67776784d9a67776e848e7776a989a6779676767e84dbd76a9a841d4ea6769e9a6769b80000000000000000000000000000
8a674d77a7776a996e9a678776a9ea776a9e88e77476a9a76a678766ea67e8e7a76779e8444876e84db4ea6776a9a67a9e870000000000000000000000000000
e9a6776a967676a776a67776777aa77676a9a9967d176a6776784e77967e847a9b976a9e8e7e979e8d1d9a79e7676776a7760000000000000000000000000000
9a6776a9e97a77677767776a9a76776a976a7a6781b177776784b476a7e84d76a6a67679776776a9e9a6767e8e777b17767a0000000000000000000000000000
a67776984e69a677767176a9b677b179e47676774d177676a9e9e8e776791b176777776767a6776a6a67e74d487778d76a990000000000000000000000000000
677769e8d48e97776a1b17669677776a4d17879674767a776a9a9776aa67ddd4798976aa9e976776767e84d1b76a67487ebe0000000000000000000000000000
79a76e84bde9a6776e4d7676a67a677e87b148e9a76a69677676766ae9a6774778b76a99e889a6777776e8487679677e76a90000000000000000000000000000
7876a99ed4676776a9876a9767e9a7a9767d8e9776a98ea777a76a9e8b8ea6766776a9e84d4e9a67767a9e776a9eaa67777a0000000000000000000000000000
a4b76a6e4ea77b87a9e979e9748e96776a67e976a7684e9a679e77a9eee96789a6776674dbd4a6777a77a76a9a98e9a677760000000000000000000000000000
e87676798e9a67e76a97684d1d48ea76a9a6776a9ee8d8e9a678b76a99a6784e977777678d4e977769a676a9e4b48e9a67670000000000000000000000000000
976a6776a9a677777676a6e8b1d4976ae89a67a9e84db4e9677e8e767a6784d8e9a676a77489a676ae9a76a9e848e9a676a60000000000000000000000000000
76a9e8476a67776777679e84da67a7768be9a67a9e8ed8e9a767e9a767767db99a67779a67ea776ae8e9a7679eea9a677a9a0000000000000000000000000000
676794db76776a98a9a679e84ea67d17848e677679ee8e967aa77a76a67a6748e97769e9a79a679e848e9a76a696a77ea9e90000000000000000000000000000
aa76774d47676ae48e976aa98e9777b768e97bd7b76ae9a6799a67769a69a67a9767ae8e967677a7bde9776777a677a8d48e0000000000000000000000000000
99ea767876a9e84b48e67676a9677676ae9a677748766a67d8e9766a848ea77776a9e84867776a7674976a9a67676a94bd490000000000000000000000000000
e48e9a6777769e898e9a67776a677a6767a777667e97767db4976a79ed48e677776a94b4a677a96a6776a9e9a67776e84e8a0000000000000000000000000000
4d48e9767697696a69a67767767769e9776776aa67a76784d8e979e84b8e9a676a77688e97669e99a67777848777a7a9e9e90000000000000000000000000000
dbd4876a98ea7a767677eaa6776a9e8e9a776999a676a9ea9e9a769ad1da6776a976a9e976a6d48e9677667be9a7976a9a670000000000000000000000000000
4d7876a98489767777848e9a677679b8a76a98ee97776a96aa67776a8d46776a9e876a976a9a1d48e76aaa679a67e976a67b0000000000000000000000000000
87676ae84d4e97a67d1d48e9a6776a8e9a784b48e97776a7677676a9e9e9769e84d176a7a9e9b1de76a9e976a67b8ea767ed0000000000000000000000000000
76a77774d1d8ae9671b1d48a671b77a9676a948e9a6777677e9a676a969a6779e84bd7769e8d1d476a9ebe67678d49777e840000000000000000000000000000
9e9677684b1d489a67dd48e67771d76776a9e8a9a677677d48777677a6a6776a9ee84e7769844e8e76a9e9a67ae78776a9e90000000000000000000000000000
e86a76a9d1e8e9a7784489a777674877a76a9e9a6777a941d7667ae76767d177a79a876a7ae88e9a677a9a67d77676776a9a0000000000000000000000000000
8489a76a4d4e9a67a9e8ea6776a77e7a9e76a96777769edb76aa6784747d1b7676a677697696a9a67876a67db76a9a6776a60000000000000000000000000000
4d48e9768e89a6776a9e96776a9a676784b7677776a9e8476e99a67d1d87d76a67676a9e87a76a67d4e767a776a9e9a677670000000000000000000000000000
d1d97a77e9ea677776a67776a9e8e9a678d47677776a9e76a88e9a67b1e676aba6797768b7677671b1d47a976a6a8e9a76760000000000000000000000000000
8b1a676a9a9a7667776777677aab86779e476a667776a76a94d4a6777a9a676767ae76a9897777677d48678479e84be67a9a0000000000000000000000000000
41de9a7676a67a976a7776ae7676e9a67976a9e9a77776a9e8b48e9a677677777a98477aea676a9a678ea67d76a984876ae90000000000000000000000000000
8d48e9a74767a9e9e9a76ae8e76a9a676a769e8e9a67776a94d8976777a7767a9ee8d476767476e9a67767b1d7a9e8767e480000000000000000000000000000
e9ee9a67d477678489a679848e7676767677e8b4a6777676a849a6776a967a67e84b18e7774d1d8e9a67771d47669e7a64d40000000000000000000000000000
7a67a67d1d48767bd48a674d48e7776ae76a9a98a7776a976e6a6776a9e9e9a798d1d8e767d1b148e9a77674e976a779edbd0000000000000000000000000000
767767d1b1d47a6798e9a7db7a97679e8e7676ae9a67a9ee7a77776a9e848ea679448e77a99d1d896a677a677a6776ae84d40000000000000000000000000000
776976771d4769a6769767476776a6e848e797a9a67a6e847677bd79e84d49e9a788e76a9e84d4967676a9a7677db769e9480000000000000000000000000000
67aea9a67476ab9a6776777a9e979e84dbd8e76a6769e84b47a6776a9e9bd48e96779a76a9e848a777779e76a674777a7a670000000000000000000000000000
a968ee97e8e7a9a6776a6767e876aa9a4d4e967676776e8e8e978477a96848e9779676776aa9a66776a9e8a69a77677767770000000000000000000000000000
9e8448a67e97676776a9e9a674b766a68e8e9a679a76a9a6e9a67d476aae8a9a67ea67db767a677a779e84e8e676a6a9a7670000000000000000000000000000
984dbd4779a77b7776ae8e9a67487767e9e9a679e9476a67a677d1d4766ae9767489a677777677a9a774d1d4877a9a9e96a60000000000000000000000000000
ae89d49a67767976aa9848a67989a7767a9a676e84db7677674d1b1d476a96774b8a77767767678e9a671b7876a9e9489a9a0000000000000000000000000000
6aee88e97a9a7a679e8ed977677a767a67a676a9e84767777e8441d48e76a79e8e979e9a76a9a848e9767767776a8d1de8e90000000000000000000000000000
76a9ae9a67e96776e84d1a679a676a89a67717679e76a676a9a8ed48e77767a9a67a98e7779e84b48e9a67a6777764b1d48e0000000000000000000000000000
676766a67e8e776a9e81b1d8e9767948ea67b1776a6796676a6ea6777677776a67798b8677a76a88e677769a6776a71d48e70000000000000000000000000000
a6787767e441d477a9a4d448767a9eb4e9a67d487776e9a7767967767a6784767a67e8e9767679e99a776ae9677698d48ea60000000000000000000000000000
98d4897a9d1b1d47676a48e9a76a9848e677849e76a98e6a776a776a69677db7e9a79ea76a9a6796a76a9e8ea77a9e4879770000000000000000000000000000
8d1d4e97e4d1d48e776e8e9a677a9e9e9a67e8e76a9a48e9677676a9ae9a67148ea67a76a9e9a677677ae848ea67a77767670000000000000000000000000000
d1b47976a84d487976a9e9a67d76a9a6a6777e76a9e8d48e77777798b8e974d489a7676aae8e9a677769e8d489a67666a9a70000000000000000000000000000
4d1767779e848767676a9a67d1d7676767776777779db8e9a6776a9e89aa6748ea76a679e848e9a6777a9d1b1e676aaa9e760000000000000000000000000000
8476a66679e876a9a676a6777b7777767776a6677674d49a778b76aa676676ee976a9a6784be9a67776e844d48e7699e98e90000000000000000000000000000
e76a9b9a7a976a9e977767776767776a76a9e9a76a6778e6777e977671776a967676e7677e48a67d76a9e884e77a9e84d48e0000000000000000000000000000
7677aaa67676a9e89a677776a9aa67a9b76e8476a99767971767a6777b7677a76a6e8ea6679e97b1d76a96e876a9e84d1d480000000000000000000000000000
6a7a776787776a8b767ba6779eb9a67676a98b77abe9a671bea76777676a9676a9e848e9a679a6794876679ea76a9ed1b1e90000000000000000000000000000
a9a9a67b48776ae767676776a76a7747976ae76a9e9a674d48967176a6a9ea679e84b48a6777679e89a776a77677684d1d4a0000000000000000000000000000
9ebe9a6777677676a6a67777677674b4877a9a76aaa6778489a71b769a8e89a76ae8e976777676a9e7674776a97a9e94d4660000000000000000000000000000
6a99a67767a7777e9e9a676a77679e777676a677666776789767776ae84d4e97767a9a67a76a6767977bd476ae76a9e8e9a60000000000000000000000000000
76a67777a99a676898e6a679e9a7776a9a676748777a9a67a67767a984d1d976a776a67e9e79a677767d47aa98e776996a670000000000000000000000000000
a767776a98e679a4d48e9767be9a6776e97774d87679e9a67776a9e84d1b176a984767e848ee67776a67769ea48e97a776760000000000000000000000000000
9e7a769ee487784d1d4996a679a676a98e9671b76ae84e674bd76a9e84d176a9e4d4767dbd48e776e9a777e84b48e767d78a0000000000000000000000000000
e8e9a7e88d7667d1b1d48e9a6767777b49a67476a9e4d4767d7776799e8d4776e8bd4974d88e96798e76779e848e9a7b1d490000000000000000000000000000
4db77694dbe9a67d44e8e9677676776ae67777776a9db76a9767676aa9e9a76a94d48e6747e9a677b97a76a9e8e9a677848e0000000000000000000000000000
8476a9e84d486784e8ee9a67ea9a777a9a76767776a47676e8a9a67666a67e76a8e869a6767a677677a9e7769a9a67a678ea0000000000000000000000000000
e9a76a97847e77e89e99a67848e9a676676a9a6777776a9a848e9777776748776a9eaa676a67776a76784db776a67b979e960000000000000000000000000000
6a67776ae9a9a67ea76a6784d48e976776a9e9a6777679e84de9a67ae97bd76776776778e9a67a9eaa67e4877767a9a677a70000000000000000000000000000
767a676a9a6777a9677679e81448e9a6777ebe67776a679ed148e7e8b76776a6e748798b8e9a67e8e9a679e67e77676776760000000000000000000000000000
478e9777a777776a71d764d1b1d48e6776a9e9a679a976741bd4897787a76a9e84d76ae9e9a67e848e96779a7be977776a6a0000000000000000000000000000
dd4876a7677677767b76a84d1d49a977777696779e8e9a67d148e9a67a9679e84d1b769a9a674dbd48e9a677679a6776a9a90000000000000000000000000000
b1d76a9e7a6a7777e76a9e84d48e9a767767779ea84e977848ee9a67eee97a7984d767a6a679e84e8e9a6776a67677779e8e0000000000000000000000000000
4d76a9e8e9a9a6784d77a9e84a96a76a6aaa67e8e4d9767e9e9a6674848a6767e976a767676a9e8ee9a67a9e9a67b769e8480000000000000000000000000000
897676848e9e9a74db777a9e86a676a9e9e97e84d1b17a67a676774dbd48e9a67a779a7e7a766ae7a667a7e8e774d76a94d10000000000000000000000000000
9a7a9e4d1d48a7e847a66779e777779e8a8e77e84d7769a777779e84848a67677769eb48e9a77797677a9e848e6776764d1b0000000000000000000000000000
a76a9e81b18e7a977a9aaa679a6776e84b48a67987677e9a6776a9e8e8e9a676776e848e6a6776a67777e84be9a76a9e84d40000000000000000000000000000
6776e84d1d89a776a9e9e9a676776a9e8e8e9a67e7a698ea67776a9e9e6a679a76a967e976748767976a9e846a677679e9480000000000000000000000000000
776a9e84ea676776ae848977777676a9e9e9a677769e84e96776776a677678e7776a7a9a671d4779847669a8e7769776ae8e0000000000000000000000000000
4b76a9a77677776a984d4767776a676a7a9a67776ae84d48776a9e767777d4767776767671b776a9eb477a679a678476a9a90000000000000000000000000000
8767766777776a9e84d1dea667a9a7767676776a9e84d1d46676a8b7a67b177a677767b74d76677684777676a677d1b7676a0000000000000000000000000000
76a777777776a9e84d1b48e9a67e9a6777978e77aaed1b1d9a679e8e9a6776a9a676a98e776a9a77e76a678777767d1877760000000000000000000000000000
679677776ae76a9e84d1d49a67d4867767e848487694d1e8e9a679e9a6766a9e677776976a9ee67676a9e8b76a7a77d487770000000000000000000000000000
a9e966777e8e7677e84d8aa67db87776a679dbd477a84a9e9667779a676a9e848ea767a776e848ea677a6776a9a9a67876670000000000000000000000000000
9e8a9a7778b8e776a9e4e9a67747676a9a674d77676e76a6777776767776ae8d4876a6776a84b49a6776776a9e4e9a676aa60000000000000000000000000000
d1d48e9a67ee76a779e89a67a676a9e9e9a6776aa979a7671d776a67676a9841d47a9a76a9e848a67667b17668d8e9a679b90000000000000000000000000000
1b1d67a67a976a976a6e76789a7a9e848e9a67a99e7a6771b769e9489a769e8b77a9e9976a9e89a7e9a674e74d149a67769a0000000000000000000000000000
4d48a67776a77ae87679a7d47769e84d48a9a67ee876767d76a98edee9676ae76a9e8ee977aae9678e9a677681bd487777a60000000000000000000000000000
948e9a674776a984876a67176a9eaed1d48e96784d479a776a98481d8e776a9776a9488e9a769a7848e9a76a4d148ea677670000000000000000000000000000
e8a9a67db76a9e4be97671b7a9e84d1b18e9a674dbd4e76a9e84d1b19a6777a6776adbd4a677a674b48e76a9e4d4e7671b770000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000bbb0bb000bb0b0b0bbb0bbb000000000bbb0bb00b000000000000000000000000000000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b0b000b0b0b000b0b00b000000b0000b00b000000000000000000000000000000000000000000000000000000000000000
b000bbb0bb00b000bb000000bbb0b0b0bbb0b0b0bb00bb0000000000bbb00b00bbb0000000000000000000000000000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b000b0bbb0b000b0b00b00000000b00b00b0b0000000000000000000000000000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000b0b0b0b0bb00bbb0bbb0b0b000000000bbb0bbb0bbb0000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

