pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8
#include serial.p8

-- a board is a 5x5 array
-- called is an array of 100
-- true/false

-- draw the boards
-- show called numbers in green
function show_boards(boards, called)
 cls(1)
 for b=1,#boards do
  -- where to show the board
  local sy=(flr((b-1)>>4)) * 8
  local sx=((b-1) % 16) * 8
  assert(#boards[b] == 5, #boards[b])
  
  for row=1,5 do
   for col=1,5 do
    local num=boards[b][row][col]
    if called[num] then
     pset(sx+col, sy+row, 11)
    else
     pset(sx+col, sy+row, 0)
    end
   end
  end
 end
 flip()
end

function is_bingo(board,called)
 for col=1,5 do
  local bingo=true
  for row=1,5 do
   if not called[board[row][col]] then
    bingo=false
    break
   end
  end
  if (bingo) then
   return true
  end
 end
 for row=1,5 do
  local bingo=true
  for col=1,5 do
   if not called[board[row][col]] then
    bingo=false
    break
   end
  end
  if (bingo) then
   return true
  end
 end
 return false
end

function find_bingo(boards,called)
 assert(called != nil)
 for b=1,#boards do
  if is_bingo(boards[b],called) then
   return b
  end
 end
end

function play_bingo(boards, order)
 local called={}
 for num in all(order) do
  called[num] = true
  show_boards(boards,called)
  local bingo=find_bingo(boards,called)
  if bingo then
   cursor(0,64)
   print("bingo! board #"..bingo)
   
   return {
    winner=bingo,
    called=called,
    last=num
   }
  end
 end 
end

function read_input(lines)
 local order=split(lines[1], ",")
 local board={}
 local boards={}
 for linenum=3,#lines do
  local lin=lines[linenum]
  if #lin==0 then
   add(boards,board)
   board = {}
  elseif #lin==1 then
   assert(false, ord(lin))
  else
   local parts=split(lin, " ")
   local nums={}
   for num in all(parts) do
    if type(num)=="number" then
     add(nums, num)
    end
   end
   assert(#nums==5,
    "line "..linenum..": length"..#lin)
   add(board, nums)
  end
 end
 if (#board) add(boards,board)
 return {order=order,boards=boards}
end


-- sum of unmarked numbers
function unmarked_sum(board, called)
 local sum = 0
 for row in all(board) do
  for num in all(row) do
   if (not called[num]) sum += num
  end
 end
 return sum
end

testboards = {
 {{22,13,17,11,0},
  {8,2,23,4,24},
  {21,9,14,16,7},
  {6,10,3,18,5},
  {1,12,20,15,19}},
 
 {{3,15,0,2,22},
  {9,18,13,17,5},
  {19,8,7,25,23},
  {20,11,10,24,4},
  {14,21,16,12,6}},
  
 {{14,21,17,24,4},
  {10,16,15,9,19},
  {18,8,23,26,20},
  {22,11,13,6,5},
  {2,0,12,3,7}}
}
testorder = {7,4,9,5,11,17,23,2,0,14,21,24,10,16,13,6,15,25,12,22,18,20,8,19,3,26,1}
called = {}

test(
 is_bingo(testboards[1],
  {[8]=true, [2]=true, [23]=true, [4]=true, [24]=true}
 ), true,
 "find a bingo"
)
test(
 is_bingo(testboards[1], {}),
 false,
 "not bingo"
)
bingo_test = play_bingo(testboards,testorder)
test(
 bingo_test.winner,
 3,
 "test winner"
)
test(
 bingo_test.last,
 24,
 "test last called"
)
test(
 bingo_test.called[24],
 true,
 "24 was called"
)
test(
 bingo_test.called[10],
 nil,
 "10 wasn't called"
)
sum = unmarked_sum(
 testboards[bingo_test.winner],
 bingo_test.called
)
test(
 bigmul(sum, bingo_test.last),
 "4512",
 "score in example"
)

test(
 unmarked_sum(testboards[1], {}),
 24*25/2,
 "sum of unmarked board"
)
test(
 unmarked_sum(testboards[1], {[20]=true}),
 24*25/2 - 20,
 "marked 20"
)

input = read_input(read_lines())
bingo = play_bingo(input.boards, input.order)
sum = unmarked_sum(
 input.boards[bingo.winner],
 bingo.called
)
print("last called: "..bingo.last)
print("unmarked sum: "..sum)
check(bigmul(sum,bingo.last))
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1000001110000011100000111000b011100000111b0000111b0000111000b011100b0b11100000111000b0111000b0111000b01110bb0011100000111b000011
10000b111000b01110b00b111b0000111bb0001110b00011100000111000b01110b00b111b00001110000011100bb0111b000011100b0011100b001110000011
10000011100b00111b000011100b001110b00b11100b00111b0b0b1110000b11100000111b000b1110000011100000111000001110b0b011100b00111b000b11
100bbb1110b0001110000b111b000b1110b000111b00bb111b00b011100b001110000b1110b0b01110b000111b000011100b00111000bb111000b011100bb011
1000bb111000001110b0001110b0001110b000111000001110bb001110bb0011100000111000b011100b00111000b0111000bb111000bb111b0b0b1110000011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1000b01110b000111b000b1110000011100b001110000011100000111000b01110000011100000111000bb111b0000111b0b0b11100b00111b000011100b0011
10bbb011100000111b000b111b0000111000001110000b11100b0b11100000111b000011100b0011100000111b0b00111b000b11100000111000b01110bb0011
10000b11100000111000001110b000111b000011100b00111000001110000b111000b0111b000011100b001110b000111000001110b00b1110b0b01110b00011
1000001110000b11100000111000001110bbbb111b0b00111000b011100bb011100000111b0000111000b0111b0000111b000b111b00001110b0001110000011
10b000111b00001110b0001110bb00111000001110bb0b11100000111000001110b00011100bb0111000b0111b0b001110000011100000111b000011100b0011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1000b011100b0011100000111b0b00111b0000111b00b011100bb011100000111b0000111b000b1110b000111b000b111000b011100000111000bb1110000b11
10b0001110b00b111000bb111000b0111000bb1110000b111bb00011100b00111000b01110b0001110b00011100b001110b0b011100000111000001110bb0b11
10000011100000111b00b0111000001110000b111000001110000011100bbb1110000b111b0000111b000011100000111000b0111bb00011100000111bb00011
100b001110b00011100b00111b0000111b00001110000011100b0011100000111b000011100000111b0b001110b000111b00b0111000001110bb001110000b11
100b001110000011100000111000001110b0001110b00011100b00111000001110b000111b0000111000bb111000001110bb001110000b111b00001110000011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10b00011100000111b000b111bbb001110bb00111000bb1110000b1110b0001110000011100000111b00b01110b0001110b0b011100b00111b000b1110000011
10bbbb1110b00b111b0000111000b01110b000111000b0111b0000111b0000111000001110b0001110b000111b0000111000001110000011100000111b00b011
100000111b0b001110b0b0111000001110b000111bbb0011100000111000b01110b00b11100000111000b011100000111000b011100b0b1110000b1110000011
100000111b000b11100000111b000b111000b01110b00b111b000011100000111b000b1110000011100000111b0b00111000001110000011100000111bb00011
10b0001110000011100000111bb0001110000b111000001110b0b0111000001110b0b01110000b1110000011100b00111000b01110000011100000111b000011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10b00011100b00111bb0001110000b111000001110b00011100b0011100b001110000b1110bb001110000011100000111bb00b1110000b111b0000111000bb11
1000001110bb001110b000111b0b0b11100000111b000b111000b0111000b01110000011100000111000001110b0b011100000111b00001110000011100b0011
100b0011100000111000001110b00b11100000111000001110b000111000b01110000011100000111b000b1110b0bb11100b00111000001110bb001110000011
1000001110000b11100b0b111000001110000b1110000b111b00b0111000001110bb0b111b0b001110b0001110b0b01110000011100000111bb000111000bb11
1000001110b0b011100b00111000b011100b001110000011100bb011100b0011100000111000001110b0001110000011100b0b111b0000111b00001110000011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
100b00111000001110000b1110000011100bb01110bb00111bb000111000001110b000111bb000111000001110b000111000b011100b0011100b00111b000011
10b00b11100b00111bb0bb1110b000111000b011100b001110b0001110bbb01110000b11100b00111000b01110000b111b0000111000001110000011100b0011
10b00011100000111000b0111b0000111000001110b00011100b001110b00b11100000111000bb111000b01110000b1110b0001110b000111000b0111b000011
1000b011100b00111000b0111b00001110000b11100bbb11100000111000b0111000b0111000001110b0b011100bbb1110b0b011100b00111b000b111000b011
100bb01110bb00111b0000111b00001110b000111b000b1110b00011100b0011100000111b0b001110b000111b0000111000001110bb00111b00001110000011
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
100b00111000bb111bb0001110000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10000b11100b0b111b0000111b0b0011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10b00b111b00b0111b000b1110000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1000001110000b111bb000111b00b011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10b0b0111b0000111000001110000b11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

