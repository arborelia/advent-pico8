pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8

function cave_paths(graph,used)
end

coords = {}
-- haphazardly visualize a graph
function make_coords(graph)
 coords = {}
 local angle=12/53
 local step=0
 for node,out in pairs(graph) do
  if node == "start" then
   coords[node] = {x=10,y=30}
  elseif node == "end" then
   coords[node] = {x=110,y=90}
  else
   coords[node] = {
    x=sin(step*angle)*40+64,
    y=cos(step*angle)*40+64
   }
   step += 1
  end
 end
end

function draw_graph(graph)
 for node,out in pairs(graph) do
  local loc = coords[node]
  for dest in all(out) do
   local loc2 = coords[dest]
   color(3)
   line(loc.x, loc.y, loc2.x, loc2.y)
  end
  cursor(loc.x,loc.y)
  color(12)
  print(node)
 end
end

function draw_path(path, c)
 for i=1,#path-1 do
  local loc = coords[path[i]]
  local loc2 = coords[path[i+1]]
  color(c)
  line(loc.x, loc.y, loc2.x, loc2.y)
 end
end

function make_graph(lines)
 local graph={}
 
 for l in all(lines) do
  nodes = split(l, "-")
  n1 = nodes[1]
  n2 = nodes[2]
  if graph[n1] == nil then
   graph[n1] = {}
  end
  if graph[n2] == nil then
   graph[n2] = {}
  end
  add(graph[n1], n2)
  add(graph[n2], n1)
 end 
 return graph
end

-- this is o(n) and i don't care
function has(list,entry)
 for item in all(list) do
  if (item==entry) return true
 end
 return false
end

function is_big(node)
 -- node starts with a "capital"
 -- letter (shows up as punyfont)
 local c = ord(at(node,1))
 return (c < ord("a"))
end

function npaths(graph,node,visited)
 draw_graph(graph)
 color(12)
 rectfill(0,0,128,6,1)
 cursor(0,0)
 for i=1,#visited do
  print(visited[i].." \0")
 end
 draw_path(visited, 10)
 if (node=="end") then
  return minify(1)
 end
  
 local total=0
 for dest in all(graph[node]) do
  if is_big(dest) or not has(visited, dest) then
   add(visited,dest)
   total += npaths(graph,dest,visited)
   -- remove this node from
   -- visited when done
   visited[#visited] = nil
  end
 end
 draw_path(visited, 3)
 return total
end

function total_paths(graph)
 local n=npaths(graph, "start", {"start"})
 cursor(0,100)
 color(15)
 return inttext(n)
end
test(is_big("A"), true, "A is big, don't ask")
test(is_big("start"), false, "start is not big")
graph = make_graph(read_lines())
make_coords(graph)
cls(1)
draw_graph(graph)
check(total_paths(graph))

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
1cc1ccc1ccc1ccc1ccc111111111111111111c111cc11111111111111111c1c1ccc111111111111111111c11ccc11111111111111111ccc1c1c1111111111111
c1111c11c1c1c1c11c111111c1111cc11111c1c1c1111111c1111cc11111c1c11c111111ccc11cc11111c1c1c1111111ccc11cc111111c11c1c11111c1c11cc1
ccc11c11ccc1cc111c111111c111c1111111c1c1c1111111c111c1111111ccc11c111111cc11c1c11111c1c1cc111111cc11c1c111111c11ccc11111cc11c111
11c11c11c1c1c1c11c111111c11111c11111cc11c1111111c11111c1111111c11c111111c111ccc11111cc11c1111111c111ccc111111c1111c11111c1c1c1c1
cc111c11c1c1c1c11c1111111cc1cc1111111cc11cc111111cc1cc111111ccc1ccc11111c111c11111111cc1ccc11111c111c1111111ccc1ccc11111c1c1ccc1
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111113333aaaabbb111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111333333331111a1b1aaaaaaaa1111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111333333333111111111111a3b11b111111aaaaaaaa11111111111111111111111111111111111111111111111111111111
1111111111111111111111133333333111111111111111111111a3b11b11111111111111aaaaaaaa111111111111111111111111111111111111111111111111
11111111111111133333333111111111111111111111111aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa1111111111111111111111111111111111111111111
1111111111aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa111111a3111111111111111111111111111113a111bb1111111111111111111111111111111111111
1111111111b3111b11b1b1b1b11b1111111111111111111111111a131111111111111111111111111111b3a1b111111111111111111111111111111111111111
1111111111bbb11b11bbb1bb111b1111111111111111111111111a131111111111111111111111111111b31a11b1111111111111111111111111111111111111
111111111111b11b11b1b1b1b11b1111111111111111111111111a11311111111111111111111111111113b1ab11111111111111111111111111111111111111
1111111111bb131b11b1b1b1b11b1111111111111111111111111a11311111111111111111111111111111311a11111111111111111111111111111111111111
111111111111113111111111111111111111111111111111111111a11311111111111111111111111111113111a1111111111111111111111111111111111111
111111111111113111111111111111111111111111111111111111a113111111111111111111111111111131111a111111111111111111111111111111111111
111111111111111311111111111111111111111111111111111111a1113111111111111111111111111111131111a11111111111111111111111111111111111
111111111111111131111111111111113111111111111111111111a1113111111111111111111111111111131111a11111111111111111111111111111111111
11111111111111111311111111111111bbb11bb111111111111111a11113111111111111111111111111111311111a1111111111111111111111111111111111
11111111111111111311111111111111bb11b11111111111111111a111131111111111111111111111111111311111a111111111111111111111111111111111
11111111111111111131111111111111b111b1b111111111111111a1111131111111111111111111111111113111111a11111111111111111111111111111111
111111111111111111131111111111113bb1bbb1111111111111111a1111311111111111111111111111111131111111a1111111111111111111111111111111
1111111111111111111311111111111131111111111111111111111a11113111111111111111111111111111131111111a111111111111111111111111111111
1111111111111111111131111111111131111111111111111111111a111113111111111111111111111111111311111111a11111111111111111111111111111
1111111111111111111113111111111131111111111111111111111a1111131111111111111111111111111113111111111a1111111111111111111111111111
1111111111111111111111311111111131111111111111111111111a11111131111111111111111111111111113111111111ab111bb111111111111111111111
1111111111111111111111311111111131111111111111111111111a1111113111111111111111111111111111311111111331b1b11111111111111111111111
1111111111111111111111131111111131111111111111111111111a1111111311111111111111111111111111311111113331b1b11111111111111111111111
11111111111111111111111131111111311111111111111111111111a11111131111111111111111111111111113111111333b11b11111111111111111111111
11111111111111111111111113111111311111111111111111111111a11111113111111111111111111111111113111113133bb11bb111111111111111111111
11111111111111111111111113111111311111111111111111111111a11111113111111111111111111111111113111131133111111111111111111111111111
11111111111111111111111111311111131111111111111111111111a11111111311111111111111111111111111311311313111111111111111111111111111
11111111111111111111111111131111131111111111111111111111a11111111311111111111111111111111111313111313111111111111111111111111111
11111111111111111111111111113111131111111111111111111111a11111111131111111111111111111111111331111313111111111111111111111111111
111111111111111111111111111131111311111111111111111111111a1111111131111111111111111111111111131111313111111111111111111111111111
111111111111111111111111111113111311111111111111111111111a1111111113111111111111111111111111331113113111111111111111111111111111
111111111111111111111111111111311311111111111111111111111a1111111113111111111111111111111113113113113111111111111111111111111111
111111111111111111111111111111311311111111111111111111111a1111111111311111111111111111111131113113113111111111111111111111111111
111111111111111111111111111111131311111111111111111111111a1111111111311111111111111111111311113131113111111111111111111111111111
111111111111111111111111111111113311111111111111111111111a1111111111131111111111111111111311111331113111111111111111111111111111
111111111111111111111111111111111311111111111111111111111a1111111111131111111111111111113111111331113111111111111111111111111111
1111111111111111111111111111111113111111111111111111111111a111111111131111111111111111131111111331113111111111111111111111111111
1111111111111111111111111111111113311111111111111111111111a111111111113111111111111111311111111331111311111111111111111111111111
1111111111111111111111111111111113131111111111111111111111a111111111113111111111111113111111111331111311111111111111111111111111
1111111111111111111111111111111113113111111111111111111111a111111111111311111111111131111111111331111311111111111111111111111111
1111111111111111111111111111111113113111111111111111111111a111111111111311111111111131111111111313111311111111111111111111111111
1111111111111111111111111111111113111311111111111111111111a111111111111131111111111311111111113113111311111111111111111111111111
11111111111111111111111111111111131111311111111111111111111a11111111111131111111113111111111113113111311111111111111111111111111
111111111111111111111111ab11bbb1131111311111111111111111111a11111111111113111111131111111111113111311311111111111111111111111111
111111111111111111111111bab1b111131111131111111111111111111a11111111111113111111311111111111131111311311111111111111111111111111
111111111111111111111111b1a1bb11131111113111111111111111111a11111111111111311113111111111111131111311311111111111111111111111111
111111111111111111111111bb1ab111131111111311111111111111111a11111111111111311113111111111111131111131311111111111111111111111111
1111111111111111111111111bb1aab1131111111311111111111111111a11111111111111131131111111111111131111131311111111111111111111111111
111111111111111111111111111111a1131111111131111111111111111a11111111111111131311111111111111311111131311111111111111111111111111
1111111111111111111111111111111a1311111111131111111111111111a1111111111111113111111111111111311111113311111111111111111111111111
11111111111111111111111111111111a311111111113111111111111111a1111111111111133111111111111111311111113311111111111111111111111111
111111111111111111111111111111111a11111111113111111111111111a1111111111111131311111111111113111111113311111111111111111111111111
1111111111111111111111111111111111a1111111111311111111111111a1111111111111311311111111111113111111111311111111111111111111111111
11111111111111111111111111111111113a111111111131111111111111a1111111111113111311111111111113111111113abb1b1b11111111111111111111
111111111111111111111111111111111131aa1111111131111111111111a11111111111311111311111111111131111113aa1b11b1b11111111111111111111
11111111111111111111111111111111113111a1111111131111111111111a111111111311111131111111111131111133aa11b11bbb11111111111111111111
111111111111111111111111111111111131111a111111113111111111111a1111111131111111131111111111311133aa1a11b1111b11111111111111111111
1111111111111111111111111111111111311111a11111111311111111111a111111113111111113111111111131331a11a11bbb1bbb11111111111111111111
11111111111111111111111111111111113111111a1111111311111111111a1111111311111111113111111111331aa11a111111111111111111111111111111
111111111111111111111111111111111131111111a111111131111111111a111111311111111111311111113311a111a1111111111111111111111111111111
1111111111111111111111111111111111311111111a11111113111111111a1111131111111111111311113313aa111a11111111111111111111111111111111
11111111111111111111111111111111113111111111aa111111311111111a111131111111111111131133111a1111a111111111111111111111111111111111
1111111111111111111111111111111111311111111111a111113111111111a111311111111111111133111aa11111a111111111111111111111111111111111
11111111111111111111111111111111113111111111111a11111311111111a11311111111111111333111a131111a1111111111111111111111111111111111
1111111111111111111111111111111111aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabb1bb11bb11111111
1111111111111111111111111111111111b333aaaaaaaa111a111113111111a31111111111113311111a1111311a111111111113333331b111b1b1b1b1111111
11111111111111111111111111111111111b133b111111aaaaaaa113111111a1111111111133111111a1311311a1111111133333311111bb11b1b1b1b1111111
1111111111111111111111111111111111b1b1b3b3111111111a1aaaaaaaa3a11111111133111111aa1131131a11113333333311111111b111b1b1b1b1111111
1111111111111111111111111111111111b1b1b1333311111111aa1113111aaaaaaa11331111111a111113131a33331333111111111111bbb1b1b1bbb1111111
111111111111111111111111111111111111111111333311111111a11311311a1111aaaaaaa11aa111111333a111333111111111111111111111111111111111
1111111111111111111111111111111111111111111131331111111a1133111a11331111111aaaaaaaa3313a3333111111111111111111111111111111111111
11111111111111111111111111111111111111111111133133311111a133111a3311111111aa3333111aaaa31111111111111111111111111111111111111111
111111111111111111111111111111111111111111111113311331111a11313a111111133a311111111111b1b11bb11111111111111111111111111111111111
1111111111111111111111111111111111111111111111111311133131a1331a1133333aa1111111111111bb11b1111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111331113313a133a331111a111111111111111b1b1b1b11111111111111111111111111111111111
111111111111111111111111111111111111111111111111111133133333aa31a111aa1111111111111111b1b1bbb11111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111133311331a3a11a111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111bb1bb133aaaa1111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111b1b1bb1113a111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111bbb1b1b111bbb11bb111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111b1b1bbb111bb11b1b111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111b111bbb111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111b111b11111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

