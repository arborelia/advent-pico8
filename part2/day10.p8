pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8

-- finds an incorrectly matched
-- bracket. if there is one,
-- returns the "score".
-- if it's correctly matched
-- or just incomplete, returns 0
function match_brackets(s)
 local stack={}
 for i=1,#s do
  local ch=sub(s,i,_)
  if ch==")" then
   if stack[#stack] == "(" then
    stack[#stack] = nil
   else
    return 3
   end
  elseif ch=="]" then
   if stack[#stack] == "[" then
    stack[#stack] = nil
   else
    return 57
   end
  elseif ch=="}" then
   if stack[#stack] == "{" then
    stack[#stack] = nil
   else
    return 1197
   end
  elseif ch==">" then
   if stack[#stack] == "<" then
    stack[#stack] = nil
   else
    return 25137
   end
  else
   -- this is an open bracket
   -- put it on the stack
   add(stack, ch)
  end
  assert(
   stack[#stack] != nil,
   "aaaaaagh tables why"
  )
 end
 return 0
end

function total_score(lines)
 local total=0
 for l in all(lines) do
  total += minify(match_brackets(l))
 end
 return inttext(total)
end

function test_brackets(s, score)
 test(match_brackets(s), score, s)
end

test_brackets("[({(<(())[]>[[{[]{<()<>>", 0)
test_brackets("{([(<{}[<>[]}>{[]{[(<()>", 1197)
test_brackets("[[<[([]))<([[{}[[()]]]", 3)
test_brackets("[{[{({}]{}}([{[{{{}}([]", 57)
test_brackets("[<(<(<(<{}))><([]([]()", 3)
test_brackets("<{([([[(<>()){}]>(<<{{", 25137)

check(total_score(read_lines()))
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
0bbbbb00000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
0bbbbb00000070007000770070007000700070000070007070000070007070007000770070000070770070007000007070000070007000000000707000000000
00bbb000000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
000b0000000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
0bbbbb00000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
0bbbbb00000070007000770070007000700070000070007070000070007070007000770070000070770070007000007070000070007000000000707000000000
00bbb000000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
000b0000000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000007700700770007000070077077007700007070007700077077007000077077000770077077000700007007000700700000000000770077007770
0bbbbb00000007007000700070000700070007007000070007007000007007000700070070000070070070007000070070000070070007000000070007007070
0bbbbb00000077007000700070007000770007707000700000707000007007700070770070000070770070007000700070000070007000000000070007007770
00bbb000000007007000700070000700070007007000070007007000007007000700070070000070070070007000070070000070070007000000070007000070
000b0000000007700700770007000070077077007700007070007700077077007000077077000770077077000700007007000700700000000000777077700070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077007700007077000700770007700700070000700700770077000770770077007700070007000770077007700000000077700000000000000000
0bbbbb00000070007000070070007000700000700070007007007000700070000700070070007000700000700070007000700700000000700000000000000000
0bbbbb00000070007000700070007000700000700070007070007000700070007700077070007000700000700070007000700000000007700000000000000000
00bbb000000070007000070070007000700000700070007007007000700070000700070070007000700000700070007000700700000000700000000000000000
000b0000000077007700007077000700770007700700070000700700770077000770770077007700070007000770077007700000000077700000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000770770007700700077077000770077077007700070077000770770007700770077077007700070077000770000000007770777000000000
0bbbbb00000070000700700007007000070007000070070007000700700070000700700007000700070007000700700070000070070000007000007000000000
0bbbbb00000070007700700077007000770007700070770007700770700070007700700077007700770007700770700070000070000000007770007000000000
00bbb000000070000700700007007000070007000070070007000700700070000700700007000700070007000700700070000070070000000070007000000000
000b0000000077000770770007700700077077000770077077007700070077000770770007700770077077007700070077000770000000007770007000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000070070000700700007007000070077077000700070070000070070077000770070077000770070007000000000077700000000000000000
0bbbbb00000070000700700007007000070070000700070007000070007007000700700070000070700070000070700000700700000000700000000000000000
0bbbbb00000070007000700070007000700070007000770007700070007000707000700070000070700070000070700000700000000007700000000000000000
00bbb000000070000700700007007000070070000700070007000070007007000700700070000070700070000070700000700700000000700000000000000000
000b0000000077000070070000700700007007000070077077000700070070000070070077000770070077000770070007000000000077700000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000000700770070077000700770077000700007070000700070007000770770007707000070000700070077007700000000077707770770077707770
0bbbbb00000007000700700070007000700070007000070007007000007000700700070000700700700007000700070007000700000000707000070000700070
0bbbbb00000070007700700070007000700070007000700000707000007000707700077000700070700070007000770077000000000077707770070007700070
00bbb000000007000700700070007000700070007000070007007000007000700700070000700700700007000700070007000700000070000070070000700070
000b0000000000700770070077000700770077000700007070000700070007000770770007707000070000700070077007700000000077707770777077700070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
0bbbbb00000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
0bbbbb00000070007000770070007000700070000070007070000070007070007000770070000070770070007000007070000070007000000000707000000000
00bbb000000070007000070070000700700070000070007070000070070070007000070070000070070007007000007007000700070007000000707000000000
000b0000000077000700077007000070070007000700070077000770700077007700077077000770077000700700070000707000700000000000777000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000007700700770007000070077077007700007070007700077077007000077077000770077077000700007007000700700000000000770077007770
0bbbbb00000007007000700070000700070007007000070007007000007007000700070070000070070070007000070070000070070007000000070007007070
0bbbbb00000077007000700070007000770007707000700000707000007007700070770070000070770070007000700070000070007000000000070007007770
00bbb000000007007000700070000700070007007000070007007000007007000700070070000070070070007000070070000070070007000000070007000070
000b0000000007700700770007000070077077007700007070007700077077007000077077000770077077000700007007000700700000000000777077700070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077007700007077000700770007700700070000700700770077000770770077007700070007000770077007700000000077700000000000000000
0bbbbb00000070007000070070007000700000700070007007007000700070000700070070007000700000700070007000700700000000700000000000000000
0bbbbb00000070007000700070007000700000700070007070007000700070007700077070007000700000700070007000700000000007700000000000000000
00bbb000000070007000070070007000700000700070007007007000700070000700070070007000700000700070007000700700000000700000000000000000
000b0000000077007700007077000700770007700700070000700700770077000770770077007700070007000770077007700000000077700000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000770770007700700077077000770077077007700070077000770770007700770077077007700070077000770000000007770777000000000
0bbbbb00000070000700700007007000070007000070070007000700700070000700700007000700070007000700700070000070070000007000007000000000
0bbbbb00000070007700700077007000770007700070770007700770700070007700700077007700770007700770700070000070000000007770007000000000
00bbb000000070000700700007007000070007000070070007000700700070000700700007000700070007000700700070000070070000000070007000000000
000b0000000077000770770007700700077077000770077077007700070077000770770007700770077077007700070077000770000000007770007000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000077000070070000700700007007000070077077000700070070000070070077000770070077000770070007000000000077700000000000000000
0bbbbb00000070000700700007007000070070000700070007000070007007000700700070000070700070000070700000700700000000700000000000000000
0bbbbb00000070007000700070007000700070007000770007700070007000707000700070000070700070000070700000700000000007700000000000000000
00bbb000000070000700700007007000070070000700070007000070007007000700700070000070700070000070700000700700000000700000000000000000
000b0000000077000070070000700700007007000070077077000700070070000070070077000770070077000770070007000000000077700000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0bb00000000700770070077000700770077000700007070000700070007000770770007707000070000700070077007700000000077707770770077707770
0bbbbb00000007000700700070007000700070007000070007007000007000700700070000700700700007000700070007000700000000707000070000700070
0bbbbb00000070007700700070007000700070007000700000707000007000707700077000700070700070007000770077000000000077707770070007700070
00bbb000000007000700700070007000700070007000070007007000007000700700070000700700700007000700070007000700000070000070070000700070
000b0000000000700770070077000700770077000700007070000700070007000770770007707000070000700070077007700000000077707770777077700070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707770777077007070000077700770777000007770770077707070777000000000000000000000000000000000000000000000000000000000000000000000
70707000707070707070000070007070707000000700707070707070070000000000000000000000000000000000000000000000000000000000000000000000
77007700777070707770000077007070770000000700707077707070070000000000000000000000000000000000000000000000000000000000000000000000
70707000707070700070000070007070707000000700707070007070070000000000000000000000000000000000000000000000000000000000000000000000
70707770707077707770000070007700707000007770707070000770070000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77007700777000007000777077007770077000007770777077707700000000000000000000000000000000000000000000000000000000000000000000000000
07000700707000007000070070707000700000007070700070707070000000000000000000000000000000000000000000000000000000000000000000000000
07000700707000007000070070707700777000007700770077707070000000000000000000000000000000000000000000000000000000000000000000000000
07000700707000007000070070707000007000007070700070707070000000000000000000000000000000000000000000000000000000000000000000000000
77707770777000007770777070707770770000007070777070707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000bbb0bb000bb0b0b0bbb0bbb000000000bbb0bbb0bbb0b000bbb0bb00000000000000000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b0b000b0b0b000b0b00b00000000b0b0b0b0b0b000b0b00b00000000000000000000000000000000000000000000000000
b000bbb0bb00b000bb000000bbb0b0b0bbb0b0b0bb00bb0000000000bbb0bbb0b0b0bbb0bbb00b00000000000000000000000000000000000000000000000000
b000b0b0b000b000b0b00000b0b0b0b000b0bbb0b000b0b00b000000b00000b0b0b0b0b000b00b00000000000000000000000000000000000000000000000000
0bb0b0b0bbb00bb0b0b00000b0b0b0b0bb00bbb0bbb0b0b000000000bbb000b0bbb0bbb000b0bbb0000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

