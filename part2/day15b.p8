pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
#include advent.p8

scale = {
 [0]=0, 1, 2, 5, 3,
 8, 14, 9, 10, 15, 7
}

o_cost = 0x8000
o_grid = 0x0
rowsize = 512
function gget(offset,row,col)
 local addr=offset+(row*rowsize+col)*2
 local hi=peek(addr)
 local lo=peek(addr+1)
 return hi*256+lo
end

function gset(offset,row,col,val)
 local hi=flr(val/256)
 local lo=val%256
 local addr=offset+(row*rowsize+col)*2
 poke(addr,hi)
 poke(addr+1,lo)
end

function debug(text)
 rectfill(0,0,128,6,0)
 color(7)
 cursor(0,0)
 print(text.."\0")
end

function parse_grid_expanded(lines, times)
 local size=#lines
 for rowrep=0,times-1 do
  for r=1,size do
   local l=lines[r]
   local origrow=split(l,"")
   for colrep=0,times-1 do
    for c=1,#origrow do
     local val=origrow[c]
     local newval = (val+rowrep+colrep)%9
     if (newval==0) newval=9
     local gr=rowrep*size + r - 1
     local gc=colrep*size + c - 1
     gset(o_grid,gr,gc,newval)
    end
   end
   add(grid, row)
  end
 end
 return grid
end


function find_path(grid,size)
 -- fill cost memory with 9999
 for row=0,size-1 do
  for col=0,size-1 do
   gset(o_cost, row, col, 9999)
  end
 end

 -- cost of top left is 0
 gset(o_cost, 0, 0, 0)
 local sofar = gget(o_cost,size-1,size-1)
 debug(sofar)

 for step=1,size*size do
  local updated=false
  for row=0,size-1 do
   for col=0,size-1 do
    local ccost=gget(o_grid,row,col)
    assert(ccost<10)
    for dr=-1,1 do
     for dc=-1,1 do
      if abs(dr)+abs(dc)==1 then
       local nr=row+dr
       local nc=col+dc
       if (nr >= 0 and nr < size and
           nc >= 0 and nc < size) then
        local best=gget(o_cost,row,col)
        local neighbor=gget(o_cost,nr,nc)
        local cost=ccost + neighbor
        debug("\af "..row..","..col.." "..best.."->"..cost)
        pause()
        if cost < best then
         gset(o_cost,row,col,cost)
         updated=true
        end
       end
      end
     end
    end
   end
  end
  if (updated==false) break
  local sofar = gget(o_cost,size-1,size-1)
  debug(sofar)
  pause()
 end
 return gget(o_cost,size-1,size-1)
end


-- test memory ops
gset(0,0,1,9999)
gset(0,0,0,1000)
test(gget(0,0,1),9999)
test(gget(0,0,0),1000)

input=[[1163751742
1381373672
2136511328
3694931569
7463417111
1319128137
1359912421
3125421639
1293138521
2311944581]]

cls(0)
grid=parse_grid_expanded(split(input,"\n",false), 5)
test(find_path(grid,50),315,"example grid")
grid=parse_grid_expanded(read_lines(), 5)
check(find_path(grid,500))

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
444444444466611111116611111111666eeeeeee6655666555669966699966686668886661666111666966699966636363336662622222444444444444444444
444444444461611111111611111111ee6eeeeeee5655656555969999699988688868881161116111996969699933636363332262622222444444444444444444
444444444461611111111611111111ee6eeeeeee5655656555969999699966686668886661166111966969699936636663332662666222444444444444444444
444444444461611111111611111111ee6eeeeeee5655656555969999699968886888886111116111996969699933633363332262626222444444444444444444
444444444466611111116661111111ee6eeeeeee6665666555666999699966686668886661666111666966699966633363336662666222444444444444444444
44444444441111177777777777777777777777777777777777777777777777777777777777777777777777777777777777777777772222444444444444444444
444444444411111711111111171111eeeeeeeeee5555575555999999999988888888881111111111999999999933333333332222222222444444444444444444
444444444411111711111111171111eeeeeeeeee5555575555999999999988888888881111111111999999999933333333332222222222444444444444444444
444444444411111711111111171111eeeeeeeeee5555575555999999999988888888881111111111999999999933333333332222222222444444444444444444
444444444411111711111111171111eeeeeeeeee5555575555999999999988888888881111111111999999999933333333332222222222444444444444444444
44444444446611171111656557555566aa666aaa6611661111665565655566696699996665666555666e666eee66696669996662626222444444444444444444
444444444416111711116565575555a6aaaa6aaa1611161111565565655599699699995565556555ee6e6e6eee99699969992262626222444444444444444444
444444444416111711116665575555a6aa666aaa1611161111565566655566699699996665566555666e666eee96696669992662666222444444444444444444
444444444416111711115565575555a6aa6aaaaa16111611115655556555699996999965555565556eeeee6eee99696999992262226222444444444444444444
444444444466611711115565575555666a666aaa6661666111666555655566696669996665666555666eee6eee66696669996662226222444444444444444444
444444444411111711115555577777777777aaaa1111177777777777777777777799995555577777777777eeee99999777777777772222444444444444444444
444444444411111711115555555555aaaaaaaaaa1111111111555555555599999999995555575555eeeeeeeeee99999799992222222222444444444444444444
444444444411111711115555555555aaaaaaaaaa1111111111555555555599999999995555575555eeeeeeeeee99999799992222222222444444444444444444
444444444411111711115555555555aaaaaaaaaa1111111111555555555599999999995555575555eeeeeeeeee99999799992222222222444444444444444444
444444444411111711115555555555aaaaaaaaaa1111111111555555555599999999995555575555eeeeeeeeee99999799992222222222444444444444444444
444444444466622722226161111111666555555566ee666eee66886668886611666111666166611166656665556662666222666a666aaa444444444444444444
4444444444226227222261611111115565555555e6eeee6eee86886868881611616111116167611155655565552262672222aa6aaa6aaa444444444444444444
4444444444266227222266611111115565555555e6eee66eee86886668881611666111666167611166655665556662666222a66aa66aaa444444444444444444
4444444444226227222211611111115565555555e6eeee6eee86886868881611116111611167611165555565556222276222aa6aaa6aaa444444444444444444
4444444444666227222211611111115565555555666e666eee66686668886661116111666166611166656665556662666222666a666aaa444444444444444444
4444444444222227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777aaaa444444444444444444
4444444444222227222211111711115555575555eeeee7eeee88888888881111171111111117111155555555552222272222aaaaaaaaaa444444444444444444
4444444444222227222211111711115555575555eeeee7eeee88888888881111171111111117111155555555552222272222aaaaaaaaaa444444444444444444
4444444444222227222211111711115555575555eeeee7eeee88888888881111171111111117111155555555552222272222aaaaaaaaaa444444444444444444
4444444444222227222211111711115555575555eeeee7eeee88888888881111171111111117111155555555552222272222aaaaaaaaaa444444444444444444
4444444444655557555566ee666eee66ff67ffff6633666333666f6fffff666566655566616611116668688888666e66eeee666f666fff444444444444444444
44444444446555575555e6ee676eeef6ff67ffff3633376333ff6f6fffff556557655511611611118868688888ee6ee6eeeeff6f6f6fff444444444444444444
44444444446665575555e6ee676eeef6ff666fff3633376333666f666fff666566655566611611116668666888e66ee6eeeef66f666fff444444444444444444
44444444446565575555e6ee676eeef6ff676fff36333763336fff6f6fff655567555561111611116888686888ee6ee6eeeeff6f6f6fff444444444444444444
44444444446665575555666e666eee666f666fff6663376333666f666fff666566655566616661116668666888666e666eee666f666fff444444444444444444
44444444445555575555eeeee7eeeefffff7ffff3333377777777777ffff555557555511111777777777778888eeeee7eeeefffff7ffff444444444444444444
44444444445555575555eeeee7eeeeffffffffff3333373333ffffffffff555557555511111711118888878888eeeeeeeeeefffff7ffff444444444444444444
44444444445555575555eeeee7eeeeffffffffff3333373333ffffffffff555557555511111711118888878888eeeeeeeeeefffff7ffff444444444444444444
44444444445555575555eeeee7eeeeffffffffff3333373333ffffffffff555557555511111711118888878888eeeeeeeeeefffff7ffff444444444444444444
44444444445555575555eeeee7eeeeffffffffff3333373333ffffffffff555557555511111711118888878888eeeeeeeeeefffff7ffff444444444444444444
444444444466996669996633676333666e666eee6665666555666363633366616661116669666999666166611166616661116661666111444444444444444444
444444444496999769993633676333ee6e6e6eee5565676555336363633311611761119969676999116117611111616161111161676111444444444444444444
444444444496999669993633666333666e6e6eee6665676555666366633366611661116669666999666117611166616661116661666111444444444444444444
4444444444969997699936333763336eee6e6eee6555676555633333633361111761116999676999611117611161116161116111176111444444444444444444
444444444466696669996663376333666e666eee6665666555666333633366616661116669666999666117611166616661116661176111444444444444444444
444444444499999799993333377777777777eeee5555577777777777333311111711119999979999111117777777777777777777771111444444444444444444
444444444499999799993333373333eeeeeeeeee5555555555333337333311111711119999999999111117111111111711111111171111444444444444444444
444444444499999799993333373333eeeeeeeeee5555555555333337333311111711119999999999111117111111111711111111171111444444444444444444
444444444499999799993333373333eeeeeeeeee5555555555333337333311111711119999999999111117111111111711111111171111444444444444444444
444444444499999799993333373333eeeeeeeeee5555555555333337333311111711119999999999111117111111111711111111171111444444444444444444
4444444444661167611166556665556611666111666f666fff66616661116662666222666a666aaa666166611166656655556669679999444444444444444444
4444444444161167611156555765551611616111ff6fff6fff11616711112262672222aa6aaa6aaa116167611155655655559969679999444444444444444444
4444444444161166611156555765551611666111666fff6fff66616661116662666222a66aa66aaa666166611156655655559669666999444444444444444444
44444444441611176111565557655516116161116fffff6fff61111761116222276222aa6aaa6aaa611167611155655655559969676999444444444444444444
4444444444666117611166655765556661666111666fff6fff66616661116662666222666a666aaa666166611166656665556669666999444444444444444444
4444444444111117111155555777777777777777777777ffff11111711112222277777777777aaaa111117111155555755559999979999444444444444444444
4444444444111117111155555555551111171111ffffffffff11111711112222272222aaaaaaaaaa111117111155555755559999999999444444444444444444
4444444444111117111155555555551111171111ffffffffff11111711112222272222aaaaaaaaaa111117111155555755559999999999444444444444444444
4444444444111117111155555555551111171111ffffffffff11111711112222272222aaaaaaaaaa111117111155555755559999999999444444444444444444
4444444444111117111155555555551111171111ffffffffff11111711112222272222aaaaaaaaaa111117111155555755559999999999444444444444444444
4444444444661166611166556665556668666888666f666fff666f676fff66616711116662666222666366633366626662226661616111444444444444444444
4444444444161167111156556565558868876888ff6fff6fffff6f676fff11616711112262626222336337633322622762221161616111444444444444444444
4444444444161166611156556665556668866888f66f666ffff66f666fff66616661116662666222366366633326622662221661666111444444444444444444
4444444444161117611156556565556888876888ff6f6fffffff6ff76fff61116761116222626222336367333322622762221161116111444444444444444444
4444444444666166611166656665556668666888666f666fff666ff76fff66616661116662666222666366633366626662226661116111444444444444444444
4444444444111117777777777755558888877777777777fffffffff7ffff11111777777777772222333337333322222777777777771111444444444444444444
4444444444111117111155555755558888888888ffffffffffffffffffff11111711112222272222333333333322222722221111171111444444444444444444
4444444444111117111155555755558888888888ffffffffffffffffffff11111711112222272222333333333322222722221111171111444444444444444444
4444444444111117111155555755558888888888ffffffffffffffffffff11111711112222272222333333333322222722221111171111444444444444444444
4444444444111117111155555755558888888888ffffffffffffffffffff11111711112222272222333333333322222722221111171111444444444444444444
44444444446655666555661166611166626622226668688888666366633366626662226661666111666e666eee66656755556f6f666fff444444444444444444
44444444445655676555161167611122622622228868688888336363633322626762221161676111ee6e6eeeee55656755556f6ff76fff444444444444444444
44444444445655666555161166611166622622226668666888366363633366626662226661666111e66e666eee5665666555666ff66fff444444444444444444
44444444445655676555161117611162222622226888686888336363633362226762226111176111ee6eee6eee5565676555ff6ff76fff444444444444444444
44444444446665666555666117611166626662226668666888666366633366626662226661176111666e666eee6665666555ff6f666fff444444444444444444
44444444445555575555111117777777777777777777777777777777333322222722221111177777777777eeee5555575555fffff7ffff444444444444444444
44444444445555575555111117111122222722228888878888333333333322222722221111171111eeeee7eeee5555575555ffffffffff444444444444444444
44444444445555575555111117111122222722228888878888333333333322222722221111171111eeeee7eeee5555575555ffffffffff444444444444444444
44444444445555575555111117111122222722228888878888333333333322222722221111171111eeeee7eeee5555575555ffffffffff444444444444444444
44444444445555575555111117111122222722228888878888333333333322222722221111171111eeeee7eeee5555575555ffffffffff444444444444444444
444444444466116661116662662222666f666fff666566655566616661116665665555666a666aaa686866688866626662226661666111444444444444444444
444444444416116761112262262222ff6f676fff556567655511616161115565565555aa6aa76aaa686867688822626762221161616111444444444444444444
444444444416116661116662262222f66f676fff666566655516616161115665565555a66aa76aaa666867688826626662221661666111444444444444444444
444444444416111761116222262222ff6f676fff655557655511616161115565565555aa6aa76aaa886867688822626762221161116111444444444444444444
444444444466611761116662666222666f666fff666557655566616661116665666555666aa76aaa886866688866626662226661116111444444444444444444
444444444411111711112222272222fffff7ffff555557777777777711115555575555aaaaa7aaaa888887888822222777777777771111444444444444444444
444444444411111711112222272222ffffffffff555555555511111111115555575555aaaaaaaaaa888888888822222722221111171111444444444444444444
444444444411111711112222272222ffffffffff555555555511111111115555575555aaaaaaaaaa888888888822222722221111171111444444444444444444
444444444411111711112222272222ffffffffff555555555511111111115555575555aaaaaaaaaa888888888822222722221111171111444444444444444444
444444444411111711112222272222ffffffffff555555555511111111115555575555aaaaaaaaaa888888888822222722221111171111444444444444444444
44444444446662662222666567655566616661116661611111666f666fff6663666333666366633368686868886a6a67aaaa6161666111444444444444444444
44444444442262262222556567655511616111111161611111ff6f6fffff3363673333336363633368686868886a6a67aaaa6161676111444444444444444444
44444444446662262222666566655566616661116661666111f66f666fff366366633336636663336668666888666a666aaa6661676111444444444444444444
44444444446222262222655557655561111161116111616111ff6fff6fff336337633333633363338868886888aa6a676aaa1161676111444444444444444444
44444444446662666222666557655566616661116661666111666f666fff666366633366633363338868886888aa6a666aaa1161666111444444444444444444
44444444442222272222555557777777777777777777777777777777ffff333337777777777777777777778888aaaaa7aaaa1111171111444444444444444444
44444444442222222222555555555511111111111111111111ffffffffff333333333333333333338888888888aaaaaaaaaa1111111111444444444444444444
44444444442222222222555555555511111111111111111111ffffffffff333333333333333333338888888888aaaaaaaaaa1111111111444444444444444444
44444444442222222222555555555511111111111111111111ffffffffff333333333333333333338888888888aaaaaaaaaa1111111111444444444444444444
44444444442222222222555555555511111111111111111111ffffffffff333333333333333333338888888888aaaaaaaaaa1111111111444444444444444444
4bb4bb44444477747474777477747774744477744444477477747774774444444444747477744444444444444444444444444444444444444444444444444444
4bbbbb44444474447474747477747474744474444444744474744744747447444444747474744444444444444444444444444444444444444444444444444444
4bbbbb44444477444744777474747774744477444444744477444744747444444444777474744444444444444444444444444444444444444444444444444444
44bbb444444474447474747474747444744474444444747474744744747447444444447474744444444444444444444444444444444444444444444444444444
444b4444444477747474747474747444777477744444777474747774777444444444447477744444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44777444444466646664666466446464444466644664666444446664664466646464666444444444444444444444444444444444444444444444444444444444
47774744444464646444646464646464444464446464646444444644646464646464464444444444444444444444444444444444444444444444444444444444
47777744444466446644666464646664444466446464664444444644646466646464464444444444444444444444444444444444444444444444444444444444
47777744444464646444646464644464444464446464646444444644646464446464464444444444444444444444444444444444444444444444444444444444
44777444444464646664646466646664444464446644646444446664646464444664464444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444

